<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://zhizhi.tangliangdong.me').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="你的指尖拥有改变世界的力量">
<meta property="og:type" content="website">
<meta property="og:title" content="XiaoTang&#39; Blog">
<meta property="og:url" content="http://zhizhi.tangliangdong.me/page/3/index.html">
<meta property="og:site_name" content="XiaoTang&#39; Blog">
<meta property="og:description" content="你的指尖拥有改变世界的力量">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="XiaoTang&#39; Blog">
<meta name="twitter:description" content="你的指尖拥有改变世界的力量">

<link rel="canonical" href="http://zhizhi.tangliangdong.me/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>XiaoTang' Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>
<script src="/lib/jquery.js??v=2.1.3"></script>

<body itemscope itemtype="http://schema.org/WebPage">

  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">XiaoTang' Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/books/" rel="section"><i class="fa fa-fw fa-book"></i>阅读</a>

  </li>
        <li class="menu-item menu-item-movies">

    <a href="/movies/" rel="section"><i class="fa fa-fw fa-video-camera"></i>电影</a>

  </li>
        <li class="menu-item menu-item-games">

    <a href="/games/" rel="section"><i class="fa fa-fw fa-gamepad"></i>游戏</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>
    <a href="https://github.com/tangliangdong" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub">
      <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#222; color:#fff; position: absolute; top: 0; border: 0; right: 0; z-index: 1000" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
  <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
      </svg>
    </a>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/10/29/2019-10-29-美国的宪政历程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/29/2019-10-29-%E7%BE%8E%E5%9B%BD%E7%9A%84%E5%AE%AA%E6%94%BF%E5%8E%86%E7%A8%8B/" class="post-title-link" itemprop="url">2019-10-29-美国的宪政历程</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年10月29日 22:27:40" itemprop="dateCreated datePublished" datetime="2019-10-29T22:27:40+08:00">2019年10月29日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/阅读/" itemprop="url" rel="index">
                    <span itemprop="name">阅读</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/10/29/2019-10-29-美国的宪政历程/" class="post-meta-item leancloud_visitors" data-flag-title="2019-10-29-美国的宪政历程" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/10/29/2019-10-29-美国的宪政历程/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/29/2019-10-29-美国的宪政历程/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/10/29/2019-10-29-python3-方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/29/2019-10-29-python3-%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">python3 的一些实用方法</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年10月29日 17:33:07" itemprop="dateCreated datePublished" datetime="2019-10-29T17:33:07+08:00">2019年10月29日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/10/29/2019-10-29-python3-方法/" class="post-meta-item leancloud_visitors" data-flag-title="python3 的一些实用方法" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/10/29/2019-10-29-python3-方法/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/29/2019-10-29-python3-方法/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="python实现list去重"><a href="#python实现list去重" class="headerlink" title="python实现list去重"></a>python实现list去重</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先将列表转化为set，再转化为list就可以实现去重操作</span></span><br><span class="line">list(set(list))  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 用sort即可实现排序</span></span><br><span class="line">list.sort()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quote(item.xpath(<span class="string">'@src'</span>)[<span class="number">0</span>], safe=string.printable)</span><br></pre></td></tr></table></figure>

<h3 id="python转换编码"><a href="#python转换编码" class="headerlink" title="python转换编码"></a>python转换编码</h3><blockquote>
<p> 按照标准， URL 只允许一部分 ASCII 字符（数字字母和部分符号），其他的字符（如汉字）是不符合 URL 标准的。<br>所以 URL 中使用其他字符就需要进行 URL 编码。 </p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="comment"># safe表示可以忽略的字符</span></span><br><span class="line"><span class="comment"># string.printable 表示可打印的字符，见下方 string模块</span></span><br><span class="line">quote(<span class="string">'http://www.obzhi.com/wp-content/themes/Loostrive/timthumb.php?src=http://www.obzhi.com/wp-content/uploads/2019/10/eveoline.jpg&amp;h=200&amp;w=300&amp;zc=1'</span>), safe=string.printable)</span><br></pre></td></tr></table></figure>

<h4 id="String模块中的常量："><a href="#String模块中的常量：" class="headerlink" title="String模块中的常量："></a>String模块中的常量：</h4><blockquote>
<p>string.digits：数字0~9</p>
<p>string.letters：所有字母（大小写）</p>
<p>string.lowercase：所有小写字母</p>
<p>string.printable：可打印字符的字符串</p>
<p>string.punctuation：所有标点</p>
<p>string.uppercase：所有大写字母</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> string  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string.digits  </span><br><span class="line"><span class="string">'0123456789'</span>  </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string.letters  </span><br><span class="line"><span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'</span>  </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string.ascii_lowercase  </span><br><span class="line"><span class="string">'abcdefghijklmnopqrstuvwxyz'</span>  </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string.printable  </span><br><span class="line"><span class="string">'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!"#$%&amp;\'()*+,-./:;&lt;=&gt;?@[\\]^_`&#123;|&#125;~ \t\n\r\x0b\x0c'</span>  </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string.punctuation  </span><br><span class="line"><span class="string">'!"#$%&amp;\'()*+,-./:;&lt;=&gt;?@[\\]^_`&#123;|&#125;~'</span>  </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string.ascii_uppercase  </span><br><span class="line"><span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></span><br></pre></td></tr></table></figure>

<h3 id="python-网页获取的中文乱码"><a href="#python-网页获取的中文乱码" class="headerlink" title="python 网页获取的中文乱码"></a>python 网页获取的中文乱码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取天气的json</span></span><br><span class="line">r = requests.get(<span class="string">'http://www.weather.com.cn/data/sk/101210101.html'</span>)</span><br><span class="line">print(r.content) </span><br><span class="line"><span class="comment">#&#123;'weatherinfo': &#123;'city': 'æ\x9d\xadå·\x9e', 'cityid': '101210101', 'temp': '24.8', 'WD': 'ä¸\x9cå\x8c\x97é£\x8e', 'WS': 'å°\x8fäº\x8e3çº§', 'SD': '81%', 'AP': '1000.3hPa', 'njd': 'æ\x9a\x82æ\x97\xa0å®\x9eå\x86µ', 'WSE': '&lt;3', 'time': '17:50', 'sm': '2.1', 'isRadar': '1', 'Radar': 'JC_RADAR_AZ9571_JB'&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将编码格式改成 utf-8</span></span><br><span class="line">r.encoding = <span class="string">'utf-8'</span></span><br><span class="line">print(r.json())</span><br><span class="line"><span class="comment">#&#123;'weatherinfo': &#123;'city': '杭州', 'cityid': '101210101', 'temp': '24.8', 'WD': '东北风', 'WS': '小于3级', 'SD': '81%', 'AP': '1000.3hPa', 'njd': '暂无实况', 'WSE': '&lt;3', 'time': '17:50', 'sm': '2.1', 'isRadar': '1', 'Radar': 'JC_RADAR_AZ9571_JB'&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="python-定时器"><a href="#python-定时器" class="headerlink" title="python 定时器"></a>python 定时器</h3>
      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/10/27/2019-10-27-电车难题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/27/2019-10-27-%E7%94%B5%E8%BD%A6%E9%9A%BE%E9%A2%98/" class="post-title-link" itemprop="url">记录《电车难题》</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年10月27日 14:46:33" itemprop="dateCreated datePublished" datetime="2019-10-27T14:46:33+08:00">2019年10月27日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/阅读/" itemprop="url" rel="index">
                    <span itemprop="name">阅读</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/10/27/2019-10-27-电车难题/" class="post-meta-item leancloud_visitors" data-flag-title="记录《电车难题》" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/10/27/2019-10-27-电车难题/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/27/2019-10-27-电车难题/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>杰里米·边沁的“功利主义”：一个行为的正确与否，完全取决于其造成的后果；而我们的行为准则，应当是以“最多数人之最大幸福”为目的。——判断好坏的标准：是否造成幸福的最大化。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/10/27/2019-10-27-电车难题/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/10/25/2019-10-25-bash命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/25/2019-10-25-bash%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">bash快捷键</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年10月25日 15:37:06" itemprop="dateCreated datePublished" datetime="2019-10-25T15:37:06+08:00">2019年10月25日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/10/25/2019-10-25-bash命令/" class="post-meta-item leancloud_visitors" data-flag-title="bash快捷键" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/10/25/2019-10-25-bash命令/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/25/2019-10-25-bash命令/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>956</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>生活在 Bash shell 中，熟记以下快捷键，将极大的提高你的命令行操作效率。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/10/25/2019-10-25-bash命令/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/10/23/2019-10-23-docker命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/23/2019-10-23-docker%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">docker命令</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年10月23日 22:42:20" itemprop="dateCreated datePublished" datetime="2019-10-23T22:42:20+08:00">2019年10月23日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年12月10日 11:59:45" itemprop="dateModified" datetime="2019-12-10T11:59:45+08:00">2019年12月10日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/10/23/2019-10-23-docker命令/" class="post-meta-item leancloud_visitors" data-flag-title="docker命令" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/10/23/2019-10-23-docker命令/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/23/2019-10-23-docker命令/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>794</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="docker通过Dockerfile构建镜像"><a href="#docker通过Dockerfile构建镜像" class="headerlink" title="docker通过Dockerfile构建镜像"></a>docker通过Dockerfile构建镜像</h3><p>在Dockerfile同级目录下执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t tangliangdong/nginx .</span><br></pre></td></tr></table></figure>

<h3 id="docker-开机自动启动"><a href="#docker-开机自动启动" class="headerlink" title="docker 开机自动启动"></a>docker 开机自动启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker.service</span><br></pre></td></tr></table></figure>

<h3 id="docker-容器开机自启动"><a href="#docker-容器开机自启动" class="headerlink" title="docker 容器开机自启动"></a>docker 容器开机自启动</h3><p>在运行docker容器时可以加如下参数来保证每次docker服务重启后容器也自动重启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --restart=always &lt;CONTAINER ID&gt;</span><br></pre></td></tr></table></figure>

<p>如果已经启动了则可以使用如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update --restart=always &lt;IMAGE ID&gt;</span><br></pre></td></tr></table></figure>

<p>查看容器的重启设置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect -f "&#123;&#123; .State.StartedAt &#125;&#125;" &lt;CONTAINER ID&gt;</span><br></pre></td></tr></table></figure>

<h3 id="docker-进入已经运行的容器"><a href="#docker-进入已经运行的容器" class="headerlink" title="docker 进入已经运行的容器"></a>docker 进入已经运行的容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker attach &lt;CONTAINER ID&gt;</span><br><span class="line"></span><br><span class="line">docker exec -it &lt;CONTAINER ID&gt; /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="docker查看网络"><a href="#docker查看网络" class="headerlink" title="docker查看网络"></a>docker查看网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br></pre></td></tr></table></figure>

<p>查看使用该网络的容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect app</span><br></pre></td></tr></table></figure>

<p>容器连接网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect app &lt;CONTAINER ID&gt;</span><br></pre></td></tr></table></figure>

<h3 id="docker-使用挂载"><a href="#docker-使用挂载" class="headerlink" title="docker 使用挂载"></a>docker 使用挂载</h3><p>docker可以再创建容器时将宿主机的目录挂载到容器中，这样更新宿主机的目录，即可更新docker容器中的文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -v &lt;宿主机绝对目录&gt;:&lt;容器绝对路径&gt;</span><br><span class="line"></span><br><span class="line">docker run -d -p 80 --name website -v $PWD/website:/var/www/html/website xiaotang/nginx nginx</span><br></pre></td></tr></table></figure>

<h3 id="docker-启动所有的容器"><a href="#docker-启动所有的容器" class="headerlink" title="docker 启动所有的容器"></a>docker 启动所有的容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start $(docker ps -aq)</span><br></pre></td></tr></table></figure>


      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/10/23/2019-10-23-树莓派切换openjdk版本/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/23/2019-10-23-%E6%A0%91%E8%8E%93%E6%B4%BE%E5%88%87%E6%8D%A2openjdk%E7%89%88%E6%9C%AC/" class="post-title-link" itemprop="url">树莓派切换openjdk版本</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年10月23日 13:44:33" itemprop="dateCreated datePublished" datetime="2019-10-23T13:44:33+08:00">2019年10月23日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/10/23/2019-10-23-树莓派切换openjdk版本/" class="post-meta-item leancloud_visitors" data-flag-title="树莓派切换openjdk版本" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/10/23/2019-10-23-树莓派切换openjdk版本/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/23/2019-10-23-树莓派切换openjdk版本/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>482</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="树莓派安装openjdk"><a href="#树莓派安装openjdk" class="headerlink" title="树莓派安装openjdk"></a>树莓派安装openjdk</h3><p>将tf卡烧制好官方推荐的操作系统 <a href="https://www.raspberrypi.org/downloads/" target="_blank" rel="noopener">Raspbian</a></p>
<p><img src="1.png" alt="Raspbian"></p>
<p><img src="2.png" alt="Raspbian"></p>
<p>再将树莓派插上电源启动，</p>
<p><img src="3.png" alt></p>
<p><img src="4.png" alt></p>
<p>Raspbian系统自带的是jdk是openjdk11的，但我还需要使用jdk8的，因此需要下载openjdk8</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里安装的不能是openjdk-8-jre，不然在jenkins配置jdk时，openjdk-8的安装目录是不能使用的，因为装的是openjdk-8-jre，而安装openjdk-8-jre会将open-8-jre一起安装</p>
</blockquote>
<p><img src="7.png" alt="sudo apt-get install openjdk-8-jdk"></p>
<p>安装成功后，输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p>显示的仍旧是openjdk11，因此需要进行切换</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config java</span><br></pre></td></tr></table></figure>

<p><img src="5.png" alt></p>
<p>同时该命令将安装的各个jdk地址也显示出来了。</p>
<p><code>/usr/lib/jvm</code></p>
<blockquote>
<p>如果操作的时候出错，提示权限不足，则使用sudo命令已管理员身份执行，就可以通过了。</p>
<p>如果update-alternatives没有，则通过 <code>apt-get install update-alternatives</code> 先下载安装命令</p>
</blockquote>
<hr>
<h3 id="树莓派4B-4G内存版"><a href="#树莓派4B-4G内存版" class="headerlink" title="树莓派4B 4G内存版"></a>树莓派4B 4G内存版</h3><p><img src="6.png" alt></p>

      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/10/15/2019-10-15-docker安装redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/15/2019-10-15-docker%E5%AE%89%E8%A3%85redis/" class="post-title-link" itemprop="url">2019-10-15-docker安装redis</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年10月15日 11:25:26" itemprop="dateCreated datePublished" datetime="2019-10-15T11:25:26+08:00">2019年10月15日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/10/15/2019-10-15-docker安装redis/" class="post-meta-item leancloud_visitors" data-flag-title="2019-10-15-docker安装redis" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/10/15/2019-10-15-docker安装redis/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/15/2019-10-15-docker安装redis/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>207</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="下载拉取Redis镜像"><a href="#下载拉取Redis镜像" class="headerlink" title="下载拉取Redis镜像"></a>下载拉取Redis镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis</span><br></pre></td></tr></table></figure>

<p><img src="1.png" alt></p>
<h3 id="运行docker"><a href="#运行docker" class="headerlink" title="运行docker"></a>运行docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name some-redis -d redis</span><br></pre></td></tr></table></figure>

<p>其它启动方式：</p>
<p>启动redis实例并指定<strong>端口</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis -d -p 6379:6379 redis</span><br></pre></td></tr></table></figure>

<p>启动redis实例，指定<strong>端口</strong>和<strong>密码</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis -d -p 6379:6379 redis --requirepass "123456"</span><br></pre></td></tr></table></figure>


      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/10/12/2019-10-12-springboot的websocket无法注入service/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/12/2019-10-12-springboot%E7%9A%84websocket%E6%97%A0%E6%B3%95%E6%B3%A8%E5%85%A5service/" class="post-title-link" itemprop="url">解决springboot的websocket无法注入service的问题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年10月12日 09:36:01" itemprop="dateCreated datePublished" datetime="2019-10-12T09:36:01+08:00">2019年10月12日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/10/12/2019-10-12-springboot的websocket无法注入service/" class="post-meta-item leancloud_visitors" data-flag-title="解决springboot的websocket无法注入service的问题" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/10/12/2019-10-12-springboot的websocket无法注入service/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/12/2019-10-12-springboot的websocket无法注入service/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="使用main方法启动的内置tomcat方法"><a href="#使用main方法启动的内置tomcat方法" class="headerlink" title="使用main方法启动的内置tomcat方法"></a>使用main方法启动的内置tomcat方法</h3><h4 id="springboot启动类"><a href="#springboot启动类" class="headerlink" title="springboot启动类"></a>springboot启动类</h4><p>在启动类给websocket拦截器注入应用上下文，以供拦截中获取 <em>service</em> 使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span>(exclude= &#123;DataSourceAutoConfiguration.class&#125;)</span><br><span class="line"><span class="meta">@ServletComponentScan</span></span><br><span class="line"><span class="meta">@ImportResource</span>(&#123;<span class="string">"classpath:dubbo.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorpApplication</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext applicationContext = SpringApplication.run(CorpApplication.class, args);</span><br><span class="line">        WebSocketHandshakeInterceptor.setApplicationContext(applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="websocket拦截器"><a href="#websocket拦截器" class="headerlink" title="websocket拦截器"></a>websocket拦截器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.global.interceptors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.api.AccountApi;</span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.dto.AccountDto;</span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.service.AiWebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> com.gonghui.pay.common.emun.LogTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServletServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.HandshakeInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tangliangdong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/9/27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 14:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketHandshakeInterceptor</span> <span class="keyword">implements</span> <span class="title">HandshakeInterceptor</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在启动类中调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext context)</span></span>&#123;</span><br><span class="line">        applicationContext = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterHandshake</span><span class="params">(ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse, WebSocketHandler webSocketHandler, Exception e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"After Handshake"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">beforeHandshake</span><span class="params">(ServerHttpRequest request, ServerHttpResponse serverHttpResponse, WebSocketHandler webSocketHandler, Map&lt;String, Object&gt; attributes)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        LogTemplate.LogForInfo(<span class="string">"before Handshake"</span>);</span><br><span class="line">        <span class="keyword">if</span> (request <span class="keyword">instanceof</span> ServletServerHttpRequest) &#123;</span><br><span class="line">            ServletServerHttpRequest servletRequest = (ServletServerHttpRequest) request;</span><br><span class="line">            HttpSession session = servletRequest.getServletRequest().getSession();</span><br><span class="line">            <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">                HttpServletRequest req = ((ServletServerHttpRequest) request).getServletRequest();</span><br><span class="line">                String account = req.getParameter(<span class="string">"account"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//使用account区分WebSocketHandler，以便定向发送消息</span></span><br><span class="line">                AccountDto accountDto = (AccountDto) session.getAttribute(AiWebSocketHandler.WEBSOCKET_USERINFO);</span><br><span class="line">                <span class="keyword">if</span> (accountDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 获取accountApi</span></span><br><span class="line">                    AccountApi accountApi = applicationContext.getBean(AccountApi.class);</span><br><span class="line">                    accountDto = accountApi.getAccount(account);</span><br><span class="line">                &#125;</span><br><span class="line">                attributes.put(AiWebSocketHandler.WEBSOCKET_USERINFO, accountDto);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h4><p>部署到测试环境，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AccountApi accountApi = applicationContext.getBean(AccountApi.class);</span><br></pre></td></tr></table></figure>

<p>直接报错，因为测试环境不是用的内置tomcat，不会调用Springboot的启动类，所以 <code>applicationContext</code>自然为空，自然会报错。</p>
<hr>
<h3 id="部署到Tomcat启动应用，获取service的方法"><a href="#部署到Tomcat启动应用，获取service的方法" class="headerlink" title="部署到Tomcat启动应用，获取service的方法"></a>部署到Tomcat启动应用，获取service的方法</h3><h3 id="将-WebSocketHandshakeInterceptor-添加到spring的应用上下文中"><a href="#将-WebSocketHandshakeInterceptor-添加到spring的应用上下文中" class="headerlink" title="将 WebSocketHandshakeInterceptor 添加到spring的应用上下文中"></a>将 WebSocketHandshakeInterceptor 添加到spring的应用上下文中</h3><blockquote>
<p>使用 WebSocketConfig 中注入 WebSocketHandshakeInterceptor </p>
<p>WebSocketConfig 相当于是 xml配置文件</p>
</blockquote>
<h4 id="1、方法一-（通过-Bean）"><a href="#1、方法一-（通过-Bean）" class="headerlink" title="1、方法一 （通过@Bean）"></a>1、方法一 （通过@Bean）</h4><h5 id="websocket配置文件"><a href="#websocket配置文件" class="headerlink" title="websocket配置文件"></a>websocket配置文件</h5><blockquote>
<p>必须加上<code>@Configuration</code>注解，<code>Spring</code>才能统一管理当前的拦截器实例。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.global.interceptors.WebSocketHandshakeInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.service.AiWebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.handler.TextWebSocketHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/9/27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 14:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.注册WebSocket</span></span><br><span class="line">        <span class="comment">// webSocketHandshakeInterceptor()调用下面@Bean里的方法</span></span><br><span class="line">        registry.addHandler(webSocketHandler(), <span class="string">"/websocket"</span>)</span><br><span class="line">			.addInterceptors(webSocketHandshakeInterceptor())</span><br><span class="line">			.setAllowedOrigins(<span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.注册SockJS，提供SockJS支持(主要是兼容ie8)</span></span><br><span class="line">        registry.addHandler(webSocketHandler(),<span class="string">"/websocket"</span>)</span><br><span class="line">            .addInterceptors(webSocketHandshakeInterceptor())</span><br><span class="line">            .setAllowedOrigins(<span class="string">"*"</span>)</span><br><span class="line">            .withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TextWebSocketHandler <span class="title">webSocketHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AiWebSocketHandler();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebSocketHandshakeInterceptor <span class="title">webSocketHandshakeInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebSocketHandshakeInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>之前 WebSocketConfig 配置了 <code>WebSocketHandshakeInterceptor</code>，springboot启动一直报错，<code>WebSocketHandshakeInterceptor</code>不能被重写</p>
</blockquote>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">***************************</span><br><span class="line">APPLICATION FAILED <span class="keyword">TO</span> START</span><br><span class="line">***************************</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line"></span><br><span class="line">The bean <span class="string">'webSocketHandshakeInterceptor'</span>, defined <span class="keyword">in</span> <span class="keyword">class</span> path resource [com/gonghui/intelligentization/config/WebSocketConfig.<span class="keyword">class</span>], could <span class="keyword">not</span> be registered. A bean <span class="keyword">with</span> that <span class="keyword">name</span> has already been defined <span class="keyword">in</span> <span class="keyword">file</span> [E:\tangliangdong\gfp-intelligentization-<span class="keyword">platform</span>\corp\target\classes\com\gonghui\intelligentization\global\interceptors\WebSocketHandshakeInterceptor.<span class="keyword">class</span>] <span class="keyword">and</span> overriding <span class="keyword">is</span> disabled.</span><br></pre></td></tr></table></figure>

<p>因为在 <code>WebSocketHandshakeInterceptor</code>类上加了 <code>@Component</code>，因此不能再次注入了</p>
<h5 id="websocket拦截器（游离在spring应用上下文环境之外）"><a href="#websocket拦截器（游离在spring应用上下文环境之外）" class="headerlink" title="websocket拦截器（游离在spring应用上下文环境之外）"></a>websocket拦截器（游离在spring应用上下文环境之外）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.global.interceptors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.api.AccountApi;</span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.dto.AccountDto;</span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.service.AiWebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> com.gonghui.pay.common.emun.LogTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServletServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.HandshakeInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tangliangdong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/9/27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 14:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketHandshakeInterceptor</span> <span class="keyword">implements</span> <span class="title">HandshakeInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 已经将 WebSocketHandshakeInterceptor 接入spring的上下文环境了，所以可以直接注入</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountApi accountApi;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterHandshake</span><span class="params">(ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse, WebSocketHandler webSocketHandler, Exception e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"After Handshake"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">beforeHandshake</span><span class="params">(ServerHttpRequest request, ServerHttpResponse serverHttpResponse, WebSocketHandler webSocketHandler, Map&lt;String, Object&gt; attributes)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        LogTemplate.LogForInfo(<span class="string">"before Handshake"</span>);</span><br><span class="line">        <span class="keyword">if</span> (request <span class="keyword">instanceof</span> ServletServerHttpRequest) &#123;</span><br><span class="line">            ServletServerHttpRequest servletRequest = (ServletServerHttpRequest) request;</span><br><span class="line">            HttpSession session = servletRequest.getServletRequest().getSession();</span><br><span class="line">            <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">                HttpServletRequest req = ((ServletServerHttpRequest) request).getServletRequest();</span><br><span class="line">                String account = req.getParameter(<span class="string">"account"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//使用userName区分WebSocketHandler，以便定向发送消息</span></span><br><span class="line">                AccountDto accountDto = (AccountDto) session.getAttribute(AiWebSocketHandler.WEBSOCKET_USERINFO);</span><br><span class="line">                <span class="keyword">if</span> (accountDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    accountDto = accountApi.getAccount(account);</span><br><span class="line">                &#125;</span><br><span class="line">                attributes.put(AiWebSocketHandler.WEBSOCKET_USERINFO, accountDto);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、方法二-（通过-Component-实现注入）"><a href="#2、方法二-（通过-Component-实现注入）" class="headerlink" title="2、方法二 （通过 @Component 实现注入）"></a>2、方法二 （通过 @Component 实现注入）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在WebSocketHandshakeInterceptor加上了@Component，已经成功加入到应用上下文，可以直接注入</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebSocketHandshakeInterceptor webSocketHandshakeInterceptor;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AiWebSocketHandler aiWebSocketHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 1.注册WebSocket</span></span><br><span class="line">        <span class="comment">// 直接使用 @Autowired注入的类</span></span><br><span class="line">        registry.addHandler(aiWebSocketHandler, <span class="string">"/websocket"</span>)</span><br><span class="line">                .addInterceptors(webSocketHandshakeInterceptor)</span><br><span class="line">                .setAllowedOrigins(<span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.注册SockJS，提供SockJS支持(主要是兼容ie8)</span></span><br><span class="line">        registry.addHandler(aiWebSocketHandler, <span class="string">"/websocket"</span>)</span><br><span class="line">                .addInterceptors(webSocketHandshakeInterceptor)</span><br><span class="line">                .setAllowedOrigins(<span class="string">"*"</span>)</span><br><span class="line">                .withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>websocket拦截器类上要加上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br></pre></td></tr></table></figure>

<hr>
<p>在此感谢公司带我的 CTO 雷老板 ヾ(๑╹◡╹)ﾉ”</p>

      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/10/11/2019-10-11-docker安装mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/11/2019-10-11-docker%E5%AE%89%E8%A3%85mysql/" class="post-title-link" itemprop="url">docker安装mysql</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年10月11日 15:44:44" itemprop="dateCreated datePublished" datetime="2019-10-11T15:44:44+08:00">2019年10月11日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020年02月19日 14:57:40" itemprop="dateModified" datetime="2020-02-19T14:57:40+08:00">2020年02月19日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/10/11/2019-10-11-docker安装mysql/" class="post-meta-item leancloud_visitors" data-flag-title="docker安装mysql" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/10/11/2019-10-11-docker安装mysql/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/11/2019-10-11-docker安装mysql/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>831</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="1-docker中搜索可用镜像"><a href="#1-docker中搜索可用镜像" class="headerlink" title="1. docker中搜索可用镜像"></a>1. docker中搜索可用镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure>

<p><img src="1.png" alt></p>
<blockquote>
<p>如果需要查看mysql可用的版本标签号，则需要去 <a href="https://hub.docker.com/" target="_blank" rel="noopener"><em>docker register</em></a> 查看。</p>
</blockquote>
<p><img src="2.png" alt></p>
<h3 id="2-拉取MySQL镜像"><a href="#2-拉取MySQL镜像" class="headerlink" title="2. 拉取MySQL镜像"></a>2. 拉取MySQL镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure>

<p><img src="3.png" alt></p>
<h3 id="3-查看本地mysql镜像"><a href="#3-查看本地mysql镜像" class="headerlink" title="3. 查看本地mysql镜像"></a>3. 查看本地mysql镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image ls mysql</span><br></pre></td></tr></table></figure>

<p><img src="4.png" alt></p>
<h3 id="4-生成并运行mysql容器"><a href="#4-生成并运行mysql容器" class="headerlink" title="4. 生成并运行mysql容器"></a>4. 生成并运行mysql容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql5.7 -e MYSQL_ROOT_PASSWORD=123456 -d -i -p 3306:3306 --restart=always  mysql:5.7 mysqld --lower_case_table_names=1</span><br></pre></td></tr></table></figure>

<p><img src="5.png" alt></p>
<p>以上参数的含义：</p>
<ul>
<li>–name mysql5.7  将容器命名为mysql5.7，后面可以用这个name进行容器的启动暂停等操作</li>
<li>-e  MYSQL_ROOT_PASSWORD=123456 设置MySQL密码为123456</li>
<li>-d  此容器在后台运行,并且返回容器的ID</li>
<li>-i  以交互模式运行容器</li>
<li>-p  进行端口映射，格式为<code>主机(宿主)端口:容器端口</code></li>
<li>–restart=always  当docker重启时，该容器自动重启</li>
<li>–lower_case_table_names=1  数据库表名不区分大小写，在window下是不区分大小写的， 可能在本地运行是OK的，但是一旦到测试环境就不行了。</li>
</ul>
<div class="note danger">
            <p>如果在创建容器的时候有些属性未设置，比如 <code>lower_case_table_names</code>，<code>MYSQL_ROOT_PASSWORD</code>, 可以去到</p><p><code>/var/lib/docker/containers/&lt;container id&gt;</code> 文件目录下，可以修改下面两个文件的参数</p><ul><li>hostconfig.json</li><li>config.v2.json</li></ul><p>然后重启 docker，其中的参数才会生效，只是重启容器是无效的。</p>
          </div>



<h3 id="进入mysql容器"><a href="#进入mysql容器" class="headerlink" title="进入mysql容器"></a>进入mysql容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -ti mysql /bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="6.png" alt></p>
<blockquote>
<p>很多参数的修改都不用进入到容器中，而是在创建容器的时候就赋予了的。</p>
</blockquote>
<hr>
<p>参考自 <a href="https://juejin.im/post/5babba8e5188255c960c3c63" target="_blank" rel="noopener">瑜戈的基于docker安装MySQL</a></p>

      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/09/30/2019-9-30-websocket-spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/30/2019-9-30-websocket-spring/" class="post-title-link" itemprop="url">spring实现websocket</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年09月30日 05:00:00" itemprop="dateCreated datePublished" datetime="2019-09-30T05:00:00+08:00">2019年09月30日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/09/30/2019-9-30-websocket-spring/" class="post-meta-item leancloud_visitors" data-flag-title="spring实现websocket" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/09/30/2019-9-30-websocket-spring/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/09/30/2019-9-30-websocket-spring/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="三种方式配置websocket"><a href="#三种方式配置websocket" class="headerlink" title="三种方式配置websocket"></a>三种方式配置websocket</h3><ul>
<li>使用Java提供的@ServerEndpoint注解实现</li>
<li>使用Spring提供的低层级WebSocket API实现</li>
<li>使用STOMP消息实现</li>
</ul>
<hr>
<blockquote>
<p>要注意所需的包要兼容，不然可能无法初始化 <code>bean</code></p>
</blockquote>
<h4 id="一、使用Java提供的-ServerEndpoint注解实现"><a href="#一、使用Java提供的-ServerEndpoint注解实现" class="headerlink" title="一、使用Java提供的@ServerEndpoint注解实现"></a>一、使用Java提供的@ServerEndpoint注解实现</h4><blockquote>
<p>使用@ServerEndpoint注解监听一个WebSocket请求路径：</p>
</blockquote>
<p>这里监听的是 <code>/websocket</code> ，后面的<code>{account}</code>是websocket建立连接时传递的参数，在方法里通过 <code>@PathParam(&quot;account&quot;) String account</code> 来获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.PathParam;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tangliangdong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/9/30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 16:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ServerEndpoint</span>(<span class="string">"/websocket/&#123;account&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketEndpoint</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Session session, @PathParam(<span class="string">"account"</span>)</span>String account) </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"已连接"</span>);</span><br><span class="line">        System.out.println(<span class="string">"用户"</span>+account+<span class="string">" 登录"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Session session, String message)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        session.getBasicRemote().sendText(<span class="string">"Receive message: "</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">error</span><span class="params">(Session session, Throwable t)</span></span>&#123;</span><br><span class="line">        t.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"连接关闭"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>WebSocket</code> 配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.service.WebSocketEndpoint;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.standard.ServerEndpointExporter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * websocket相关配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/9/30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 16:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebSocketEndpoint <span class="title">WebSocketEndpoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebSocketEndpoint();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerEndpointExporter <span class="title">serverEndpointExporter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerEndpointExporter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="二、使用Spring提供的低层级WebSocket-API实现"><a href="#二、使用Spring提供的低层级WebSocket-API实现" class="headerlink" title="二、使用Spring提供的低层级WebSocket API实现"></a>二、使用Spring提供的低层级WebSocket API实现</h4><h5 id="1-添加一个WebSocketHandler："><a href="#1-添加一个WebSocketHandler：" class="headerlink" title="1. 添加一个WebSocketHandler："></a>1. 添加一个WebSocketHandler：</h5><p>定义一个继承了AbstractWebSocketHandler类的消息处理类，然后自定义对”建立连接“、”接收/发送消息“、”异常情况“等情况进行处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tangliangdong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/9/27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 14:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AiWebSocketHandler</span> <span class="keyword">extends</span> <span class="title">TextWebSocketHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger LOGGER = LoggerFactory.getLogger(WebSocketHandler.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//已建立连接的用户</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ArrayList&lt;WebSocketSession&gt; users = <span class="keyword">new</span> ArrayList&lt;WebSocketSession&gt;();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理前端发送的文本信息</span></span><br><span class="line"><span class="comment">     * js调用websocket.send时候，会调用该方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleTextMessage</span><span class="params">(WebSocketSession session, TextMessage message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String username = (String) session.getAttributes().get(<span class="string">"WEBSOCKET_USERNAME"</span>);</span><br><span class="line">        <span class="comment">// 获取提交过来的消息详情</span></span><br><span class="line">        LOGGER.debug(<span class="string">"收到用户 "</span> + username + <span class="string">"的消息:"</span> + message.toString());</span><br><span class="line">        <span class="comment">//回复一条信息，</span></span><br><span class="line">        session.sendMessage(<span class="keyword">new</span> TextMessage(<span class="string">"reply msg:"</span> + message.getPayload()));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当新连接建立的时候，被调用</span></span><br><span class="line"><span class="comment">     * 连接成功时候，会触发页面上onOpen方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        users.add(session);</span><br><span class="line">        String username = (String) session.getAttributes().get(<span class="string">"WEBSOCKET_USERNAME"</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"用户 "</span> + username + <span class="string">" Connection Established"</span>);</span><br><span class="line">        session.sendMessage(<span class="keyword">new</span> TextMessage(username + <span class="string">" connect"</span>));</span><br><span class="line">        session.sendMessage(<span class="keyword">new</span> TextMessage(<span class="string">"hello wellcome"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当连接关闭时被调用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus status)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String username = (String) session.getAttributes().get(<span class="string">"WEBSOCKET_USERNAME"</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"用户 "</span> + username + <span class="string">" Connection closed. Status: "</span> + status);</span><br><span class="line">        users.remove(session);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 传输错误时调用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exception</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleTransportError</span><span class="params">(WebSocketSession session, Throwable exception)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String username = (String) session.getAttributes().get(<span class="string">"WEBSOCKET_USERNAME"</span>);</span><br><span class="line">        <span class="keyword">if</span> (session.isOpen()) &#123;</span><br><span class="line">            session.close();</span><br><span class="line">        &#125;</span><br><span class="line">        LOGGER.debug(<span class="string">"用户: "</span> + username + <span class="string">" websocket connection closed......"</span>);</span><br><span class="line">        users.remove(session);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 给所有在线用户发送消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessageToUsers</span><span class="params">(TextMessage message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (WebSocketSession user : users) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (user.isOpen()) &#123;</span><br><span class="line">                    user.sendMessage(message);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 给某个用户发送消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessageToUser</span><span class="params">(String userName, TextMessage message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (WebSocketSession user : users) &#123;</span><br><span class="line">            <span class="keyword">if</span> (user.getAttributes().get(<span class="string">"WEBSOCKET_USERNAME"</span>).equals(userName)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (user.isOpen()) &#123;</span><br><span class="line">                        user.sendMessage(message);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-创建一个WebSocket握手拦截器"><a href="#2-创建一个WebSocket握手拦截器" class="headerlink" title="2. 创建一个WebSocket握手拦截器"></a>2. 创建一个WebSocket握手拦截器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.global.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServletServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.HandshakeInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tangliangdong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/9/27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 14:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketHandshakeInterceptor</span> <span class="keyword">implements</span> <span class="title">HandshakeInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext context)</span></span>&#123;</span><br><span class="line">        applicationContext = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterHandshake</span><span class="params">(ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse, WebSocketHandler webSocketHandler, Exception e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"After Handshake"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">beforeHandshake</span><span class="params">(ServerHttpRequest request, ServerHttpResponse serverHttpResponse, WebSocketHandler webSocketHandler, Map&lt;String, Object&gt; attributes)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        LogTemplate.LogForInfo(<span class="string">"before Handshake"</span>);</span><br><span class="line">        <span class="keyword">if</span> (request <span class="keyword">instanceof</span> ServletServerHttpRequest) &#123;</span><br><span class="line">            ServletServerHttpRequest servletRequest = (ServletServerHttpRequest) request;</span><br><span class="line">            HttpSession session = servletRequest.getServletRequest().getSession();</span><br><span class="line">            <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">                HttpServletRequest req = ((ServletServerHttpRequest) request).getServletRequest();</span><br><span class="line">                <span class="comment">// websocket连接传递的参数 account</span></span><br><span class="line">                String account = req.getParameter(<span class="string">"account"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//使用userName区分WebSocketHandler，以便定向发送消息</span></span><br><span class="line">                String userName = (String) session.getAttribute(<span class="string">"SESSION_USERNAME"</span>);</span><br><span class="line">                <span class="keyword">if</span> (userName == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    userName = <span class="string">"system-"</span> + session.getId();</span><br><span class="line">                &#125;</span><br><span class="line">                attributes.put(<span class="string">"SESSION_USERNAME"</span>, accountDto);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-Spring-WebSocket的配置文件，采用的是注解的方式"><a href="#3-Spring-WebSocket的配置文件，采用的是注解的方式" class="headerlink" title="3. Spring WebSocket的配置文件，采用的是注解的方式"></a>3. Spring WebSocket的配置文件，采用的是注解的方式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.global.config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tangliangdong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/9/27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 14:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.注册WebSocket</span></span><br><span class="line"></span><br><span class="line">        registry.addHandler(webSocketHandler(), <span class="string">"/websocket"</span>).</span><br><span class="line">                addInterceptors(<span class="keyword">new</span> WebSocketHandshakeInterceptor()).setAllowedOrigins(<span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.注册SockJS，提供SockJS支持(主要是兼容ie8)</span></span><br><span class="line">		registry.addHandler(webSocketHandler(),<span class="string">"/websocket"</span>).</span><br><span class="line">                addInterceptors(<span class="keyword">new</span> WebSocketHandshakeInterceptor()).setAllowedOrigins(<span class="string">"*"</span>).</span><br><span class="line">                withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TextWebSocketHandler <span class="title">webSocketHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AiWebSocketHandler();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端页面配置"><a href="#前端页面配置" class="headerlink" title="前端页面配置"></a>前端页面配置</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Java后端WebSocket的Tomcat实现&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    请输入：&lt;textarea rows="3" cols="100" id="inputMsg" name="inputMsg"&gt;&lt;/textarea&gt;</span><br><span class="line">	&lt;button οnclick="doSend();" id="button"&gt;发送&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript" src="http://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="http://cdn.bootcss.com/sockjs-client/1.1.1/sockjs.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line"></span><br><span class="line">    var websocket = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//判断当前浏览器是否支持WebSocket</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'WebSocket'</span> in window) &#123;</span><br><span class="line">        <span class="comment">//Websocket的连接</span></span><br><span class="line">        websocket = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:9999/websocket?account=13567175138"</span>);<span class="comment">//WebSocket对应的地址</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'MozWebSocket'</span> in window) &#123;</span><br><span class="line">        <span class="comment">//Websocket的连接</span></span><br><span class="line">        websocket = <span class="keyword">new</span> MozWebSocket(<span class="string">"ws://localhost:9999/websocket"</span>);<span class="comment">//SockJS对应的地址</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//SockJS的连接</span></span><br><span class="line">        websocket = <span class="keyword">new</span> SockJS(<span class="string">"ws://localhost:9999/websocket"</span>);    <span class="comment">//SockJS对应的地址</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    websocket.onopen = onOpen;</span><br><span class="line">    websocket.onmessage = onMessage;</span><br><span class="line">    websocket.onerror = onError;</span><br><span class="line">    websocket.onclose = onClose;</span><br><span class="line"> </span><br><span class="line">    <span class="function">function <span class="title">onOpen</span><span class="params">(openEvt)</span> </span>&#123;</span><br><span class="line">    	console.log(<span class="string">"成功连接"</span>)</span><br><span class="line">    	console.log(openEvt)</span><br><span class="line">        <span class="comment">//alert(openEvt.Data);</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function">function <span class="title">onMessage</span><span class="params">(evt)</span> </span>&#123;</span><br><span class="line">        console.log(evt.data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">function <span class="title">onError</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	console.log(<span class="string">"websocket出现错误"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">function <span class="title">onClose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	console.log(<span class="string">"websocket关闭"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(function()&#123;</span><br><span class="line">        $(<span class="string">"#button"</span>).click(function(e)&#123;</span><br><span class="line">            console.log(e)</span><br><span class="line">            <span class="keyword">if</span> (websocket.readyState == websocket.OPEN) &#123;</span><br><span class="line">                var msg = document.getElementById(<span class="string">"inputMsg"</span>).value;</span><br><span class="line">                console.log(msg)</span><br><span class="line">                websocket.send(msg);<span class="comment">//调用后台handleTextMessage方法</span></span><br><span class="line">                console.log((<span class="string">"发送成功!"</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                console.log((<span class="string">"连接失败!"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="三、使用STOMP消息实现"><a href="#三、使用STOMP消息实现" class="headerlink" title="三、使用STOMP消息实现"></a>三、使用STOMP消息实现</h4><p>STOMP是一个用于C/S之间进行异步消息传输的简单文本协议, 全称是Simple Text Oriented Messaging Protocol。</p>
<blockquote>
<p>其实STOMP协议并不是为WS所设计的, 它其实是消息队列的一种协议, 和AMQP,JMS是平级的。 只不过由于它的简单性恰巧可以用于定义WS的消息体格式。 目前很多服务端消息队列都已经支持了STOMP, 比如RabbitMQ, Apache ActiveMQ等。很多语言也都有STOMP协议的客户端解析库，像JAVA的Gozirra，C的libstomp，Python的pyactivemq，JavaScript的stomp.js等等。</p>
</blockquote>
<h4 id="1、Spring配置STOMP消息"><a href="#1、Spring配置STOMP消息" class="headerlink" title="1、Spring配置STOMP消息"></a>1、Spring配置STOMP消息</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.global.interceptors.WebSocketInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.converter.MessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.invocation.HandlerMethodArgumentResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.invocation.HandlerMethodReturnValueHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.config.ChannelRegistration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.StompEndpointRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketTransportRegistration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * websocket相关配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/9/30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 16:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketMessageBrokerConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//用来注册Endpoint，“/gs-guide-websocket”即为客户端尝试建立连接的地址。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 需要 setAllowedOrigins("*")，不然无法访问</span></span><br><span class="line">        registry.addEndpoint(<span class="string">"/stomp-websocket"</span>)</span><br><span class="line">            .setAllowedOrigins(<span class="string">"*"</span>)</span><br><span class="line">            .withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//实现WebSocketMessageBrokerConfigurer中的此方法，配置消息代理（broker）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry config)</span> </span>&#123;</span><br><span class="line">         <span class="comment">//将"message"前缀绑定到MessageMapping注解指定的方法上。如"message/hello"被指定用greeting()方法来处理.</span></span><br><span class="line">        config.setApplicationDestinationPrefixes(<span class="string">"/message"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//启用SimpleBroker，使得订阅到此"topic"前缀的客户端可以收到greeting消息.</span></span><br><span class="line">        config.enableSimpleBroker(<span class="string">"/ai"</span>, <span class="string">"/user"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//点对点推送时，客户端订阅消息的前缀,/user为默认值，也需把 '/user' 添加到 enableSimpleBroker()中。</span></span><br><span class="line">        config.setUserDestinationPrefix(<span class="string">"/user"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureWebSocketTransport</span><span class="params">(WebSocketTransportRegistration registry)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureClientInboundChannel</span><span class="params">(ChannelRegistration registration)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureClientOutboundChannel</span><span class="params">(ChannelRegistration registration)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addArgumentResolvers</span><span class="params">(List&lt;HandlerMethodArgumentResolver&gt; argumentResolvers)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addReturnValueHandlers</span><span class="params">(List&lt;HandlerMethodReturnValueHandler&gt; returnValueHandlers)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;MessageConverter&gt; messageConverters)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、收发消息的控制器"><a href="#2、收发消息的控制器" class="headerlink" title="2、收发消息的控制器"></a>2、收发消息的控制器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.MessageMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.SendTo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.annotation.SendToUser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.SimpMessagingTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/10/8</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 9:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreetingController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SimpMessagingTemplate simpMessagingTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @SendTo 群发推送</span></span><br><span class="line">    <span class="meta">@MessageMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="meta">@SendTo</span>(<span class="string">"/ai/greetings"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String account)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"account"</span>, account);</span><br><span class="line">        map.put(<span class="string">"content"</span>, <span class="string">"hello "</span>+ account);</span><br><span class="line">        <span class="keyword">return</span> JSONObject.toJSONString(map);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// SendToUser为点对点推送</span></span><br><span class="line">    <span class="comment">// 客户端需订阅 '/user/&#123;account&#125;/ai/message'</span></span><br><span class="line">    <span class="meta">@MessageMapping</span>(<span class="string">"/queue"</span>)</span><br><span class="line">	<span class="meta">@SendToUser</span>(<span class="string">"/ai/message"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queue</span><span class="params">(String account)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"account"</span>, account);</span><br><span class="line">        map.put(<span class="string">"content"</span>, <span class="string">"hello "</span>+ account);</span><br><span class="line">        simpMessagingTemplate.convertAndSendToUser(account, <span class="string">"/queue/greetings"</span>, map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="服务端主动向客户端进行一对一推送"><a href="#服务端主动向客户端进行一对一推送" class="headerlink" title="服务端主动向客户端进行一对一推送"></a>服务端主动向客户端进行一对一推送</h4><ul>
<li>simpMessagingTemplate.convertAndSend(String destination, Object payload); // 群发</li>
<li>simpMessagingTemplate.convertAndSendToUser(String user, String destination, Object payload); // 一对一<ul>
<li><em>user</em> 是发送的用户标识</li>
<li><em>destination</em> 是发送路径</li>
<li><em>payload</em> 是发送的消息</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gonghui.intelligentization.service.websocket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.dto.AccountWebSocketDto;</span><br><span class="line"><span class="keyword">import</span> com.gonghui.intelligentization.dto.AiWebsocketAlarmDto;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.SimpMessagingTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2019/10/8</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 15:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"AiWebsocketService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AiWebsocketService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提供给用户发送消息处理</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SimpMessagingTemplate simpMessagingTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessageToUser</span><span class="params">(String account, Map&lt;String, Object&gt; data)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"给某个用户发送消息"</span>);</span><br><span class="line">        <span class="comment">// 实际发送的地址是 /user/&#123;account&#125;/ai/websocket</span></span><br><span class="line">        <span class="comment">// 客户端订阅的websocket地址为 /user/&#123;account&#125;/ai/websocket</span></span><br><span class="line">        simpMessagingTemplate.convertAndSendToUser(account, <span class="string">"/ai/websocket"</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessageToUser</span><span class="params">(Map&lt;String, Object&gt; data)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"给某个用户发送消息"</span>);</span><br><span class="line">        <span class="comment">// 实际发送的地址是 /user/&#123;account&#125;/ai/websocket</span></span><br><span class="line">        <span class="comment">// 客户端订阅的websocket地址为 /user/&#123;account&#125;/ai/websocket</span></span><br><span class="line">        simpMessagingTemplate.convertAndSend(<span class="string">"/ai/message"</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、前端页面-SockJS"><a href="#4、前端页面-SockJS" class="headerlink" title="4、前端页面 SockJS"></a>4、前端页面 SockJS</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">//使用SockJS和stomp.js来打开“gs-guide-websocket”地址的连接，这也是我们使用Spring构建的SockJS服务。</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> socket = <span class="keyword">new</span> SockJS(<span class="string">'http://localhost:9998/stomp-websocket'</span>);</span></span><br><span class="line"><span class="undefined">        stompClient = Stomp.over(socket);</span></span><br><span class="line"><span class="actionscript">        stompClient.connect(&#123;&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(frame)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">//连接成功后的回调方法</span></span></span><br><span class="line"><span class="actionscript">            setConnected(<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'Connected: '</span> + frame);</span></span><br><span class="line"><span class="actionscript">            <span class="comment">//订阅/ai/greetings地址，当服务端向此地址发送消息时，客户端即可收到。</span></span></span><br><span class="line"><span class="actionscript">            stompClient.subscribe(<span class="string">'/ai/greetings'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(greeting)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="comment">//收到消息时的回调方法，展示欢迎信息。</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(greeting.body).content);</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">            </span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 订阅一对一发送消息接口， 'xiaotang' 为用户标识</span></span></span><br><span class="line"><span class="actionscript">            stompClient.subscribe(<span class="string">'/user/xiaotang/ai/websocket'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(greeting)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="comment">//收到消息时的回调方法，展示欢迎信息。</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(greeting.body).content);</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">//断开连接的方法</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">disconnect</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (stompClient !== <span class="literal">null</span>) &#123;</span></span><br><span class="line"><span class="undefined">            stompClient.disconnect();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">        setConnected(<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"Disconnected"</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">//将用户输入的账号信息,使用STOMP客户端发送到"/message/hello"地址。它正是我们在GreetingController中定义的greeting()方法所处理的地址.</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">sendName</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        stompClient.send(<span class="string">"/message/hello"</span>, &#123;&#125;, <span class="built_in">JSON</span>.stringify(&#123;<span class="string">'account'</span>: $(<span class="string">"#account"</span>).val()&#125;));</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>要确保 <code>spring-websocket</code> 、<code>spring-messaging</code>与 <code>spring-core</code> 的版本号一致，不然会无法创建 <em>bean</em></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-messaging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>转载自：</p>
<ul>
<li><a href="https://www.zifangsky.cn/1355.html" target="_blank" rel="noopener">Spring Boot中使用WebSocket总结（一）：几种实现方式详解</a></li>
<li><a href="https://blog.csdn.net/zsg88/article/details/76862495" target="_blank" rel="noopener">使用spring-websocket包搭建websocket服务</a></li>
</ul>

      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/08/14/2019-8-14-navicat完成离线激活/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/14/2019-8-14-navicat%E5%AE%8C%E6%88%90%E7%A6%BB%E7%BA%BF%E6%BF%80%E6%B4%BB/" class="post-title-link" itemprop="url">2019-8-14-navicat完成离线激活</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年08月14日 15:45:43" itemprop="dateCreated datePublished" datetime="2019-08-14T15:45:43+08:00">2019年08月14日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/08/14/2019-8-14-navicat完成离线激活/" class="post-meta-item leancloud_visitors" data-flag-title="2019-8-14-navicat完成离线激活" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/08/14/2019-8-14-navicat完成离线激活/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/08/14/2019-8-14-navicat完成离线激活/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这份repo将会告诉你Navicat是怎么完成离线激活的。</p>
<p><a href="https://blog.csdn.net/wqq1027/article/details/86677079" target="_blank" rel="noopener">注册机是怎么工作的?</a></p>
<h2 id="如何使用这个注册机"><a href="#如何使用这个注册机" class="headerlink" title="如何使用这个注册机"></a>如何使用这个注册机</h2><ol>
<li><p><a href="https://github.com/DoubleLabyrinth/navicat-keygen/releases" target="_blank" rel="noopener">从这里</a>下载最新的release。</p>
</li>
<li><p>使用<code>navicat-patcher.exe</code>替换掉<code>navicat.exe</code>和<code>libcc.dll</code>里的Navicat激活公钥。</p>
</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">navicat-patcher</span><span class="selector-class">.exe</span> &lt;<span class="selector-tag">Navicat</span> <span class="selector-tag">installation</span> <span class="selector-tag">path</span>&gt; <span class="selector-attr">[RSA-2048 PEM file]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;Navicat installation path&gt;</code>: Navicat的完整安装路径。</li>
</ul>
<p><strong>这个参数必须指定。</strong></p>
<ul>
<li><code>[RSA-2048 PEM file]</code>: RSA-2048私钥文件的完整路径或相对路径。</li>
</ul>
<p><strong>这个参数是可选的。</strong> 如果未指定，<code>navicat-patcher.exe</code>将会在当前目录生成一个新的RSA-2048私钥文件。</p>
<p><strong>例如：(在cmd.exe中)</strong> </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navicat-patcher<span class="selector-class">.exe</span> <span class="string">"C:\Program Files\PremiumSoft\Navicat Premium 12"</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>地址字符串必须用双引号，使用单引号会报错</p>
</blockquote>
<p><img src="3.png" alt></p>
<hr>
<p><strong>Navicat Premium 12.1.12 简体中文版已通过测试</strong>。下面将是一份样例输出。</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">***************************************************</span><br><span class="line">*       Navicat Patcher by @DoubleLabyrinth       *</span><br><span class="line">*           Release date: Jan<span class="number"> 19 </span>2019             *</span><br><span class="line">***************************************************</span><br><span class="line"> </span><br><span class="line">Press Enter to continue or Ctrl + C to abort.</span><br><span class="line"> </span><br><span class="line">MESSAGE: PatchSolution0 will be omitted.</span><br><span class="line"> </span><br><span class="line">MESSAGE: PatchSolution3: Keywords[0] has been found:</span><br><span class="line">         Relative Machine Code Offset = +0x0000000001644a08</span><br><span class="line">         Relative Machine Code RVA    = +0x0000000001645608</span><br><span class="line">         Patch Offset                 = +0x00000000023d56e4</span><br><span class="line">         Patch Size                   =<span class="number"> 3 </span>byte(s)</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MESSAGE: PatchSolution3: Keywords[110] has been found:</span><br><span class="line">         Relative Machine Code Offset = +0x000000000165155e</span><br><span class="line">         Relative Machine Code RVA    = +0x000000000165215e</span><br><span class="line">         Patch Offset                 = +0x0000000001651561</span><br><span class="line">         Patch Size                   =<span class="number"> 1 </span>byte(s)</span><br><span class="line"> </span><br><span class="line">MESSAGE: PatchSolution2 will be omitted.</span><br><span class="line"> </span><br><span class="line">MESSAGE: PatchSolution1: Keywords[0] has been found: offset = +0x021f7390.</span><br><span class="line">MESSAGE: PatchSolution1: Keywords[1] has been found: offset = +0x0074bd39.</span><br><span class="line">MESSAGE: PatchSolution1: Keywords[2] has been found: offset = +0x021f70a0.</span><br><span class="line">MESSAGE: PatchSolution1: Keywords[3] has been found: offset = +0x0074bd1f.</span><br><span class="line">MESSAGE: PatchSolution1: Keywords[4] has been found: offset = +0x021f708c.</span><br><span class="line"> </span><br><span class="line">MESSAGE: Generating new RSA private key, it may take a long time.</span><br><span class="line">MESSAGE: New RSA private key has been saved to RegPrivateKey.pem.</span><br><span class="line"> </span><br><span class="line">Your RSA public key:</span><br><span class="line">-----BEGIN PUBLIC KEY--<span class="yaml"><span class="meta">---</span></span></span><br><span class="line"><span class="yaml"><span class="string">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsWnV5hQxlXvDA3Ad4k5N</span></span></span><br><span class="line"><span class="yaml"><span class="string">ZLz4cO+iGEPegSovIDcwTo097I+0pXYKPTVl+0iKC5JtJRObb4Xx9yK9gGwqkcxo</span></span></span><br><span class="line"><span class="yaml"><span class="string">o6WzKq0xY1jz7X6obxwlQCNse3Os1wr0rIY0UzP1dCpkW/5MwGbFxiB6PEVqkzmJ</span></span></span><br><span class="line"><span class="yaml"><span class="string">CmHBzZDRu/jAuL1nyoiGnUStqwENNYhyl4k7r8AiJkBZGMOCrj6v0JfgNna25Ce6</span></span></span><br><span class="line"><span class="yaml"><span class="string">QCFojlY4dkYQ5/7njQ3qpLwMeLEXEysMW3aUScSB68/vsHnB4C0fIkwfEPYZ/AC5</span></span></span><br><span class="line"><span class="yaml"><span class="string">AqbWHVbNmveB3rjV+tZZxXcLE8ArgKh1Gs+2VtnL09gwHm6WcpyPZ42G6tMDjWyw</span></span></span><br><span class="line"><span class="yaml"><span class="number">1</span><span class="string">wIDAQAB</span></span></span><br><span class="line"><span class="yaml"><span class="bullet">-</span><span class="bullet">----END</span> <span class="string">PUBLIC</span> <span class="string">KEY-----</span></span></span><br><span class="line"><span class="yaml"> </span></span><br><span class="line"><span class="yaml"><span class="string">******************************************</span></span></span><br><span class="line"><span class="yaml"><span class="string">*</span>            <span class="string">PatchSulution3</span>              <span class="string">*</span></span></span><br><span class="line"><span class="yaml"><span class="string">******************************************</span></span></span><br><span class="line"><span class="yaml"><span class="string">@</span> <span class="string">+023d56e4:</span> <span class="number">4</span><span class="string">D</span> <span class="number">49</span> <span class="number">49</span> <span class="bullet">---&gt;</span> <span class="number">4</span><span class="string">D</span> <span class="number">49</span> <span class="number">49</span></span></span><br><span class="line"><span class="yaml"><span class="string">@</span> <span class="string">+01644a63:</span> <span class="number">42</span> <span class="number">49</span> <span class="bullet">---&gt;</span> <span class="number">42</span> <span class="number">49</span></span></span><br><span class="line"><span class="yaml"><span class="string">@</span> <span class="string">+01644a68:</span> <span class="number">6</span><span class="string">A</span> <span class="bullet">---&gt;</span> <span class="number">6</span><span class="string">A</span></span></span><br><span class="line"><span class="yaml"><span class="string">@</span> <span class="string">+01644ace:</span> <span class="number">41</span> <span class="bullet">---&gt;</span> <span class="number">41</span></span></span><br><span class="line"><span class="yaml"><span class="string">...</span></span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">@ +023d58d4:<span class="number"> 36 </span>63 6A ---&gt;<span class="number"> 47 </span>36 74</span><br><span class="line">@ +023d58d8:<span class="number"> 78 </span>6C 6A<span class="number"> 75 </span>75<span class="number"> 51 </span>61 ---&gt; 4D<span class="number"> 44 </span>6A<span class="number"> 57 </span>79<span class="number"> 77 </span>31</span><br><span class="line">@ +023d58e8:<span class="number"> 77 </span>49<span class="number"> 44 </span>41 ---&gt;<span class="number"> 77 </span>49<span class="number"> 44 </span>41</span><br><span class="line">@ +0165155c:<span class="number"> 51 </span>41 ---&gt;<span class="number"> 51 </span>41</span><br><span class="line">@ +01651561:<span class="number"> 42 </span>---&gt; 42</span><br><span class="line"> </span><br><span class="line">******************************************</span><br><span class="line">*            PatchSulution1              *</span><br><span class="line">******************************************</span><br><span class="line">@ +0x021f7390</span><br><span class="line">Previous:</span><br><span class="line">+0x00000000021F7390 <span class="number"> 44 </span>37<span class="number"> 35 </span>31<span class="number"> 32 </span>35<span class="number"> 42 </span>37<span class="number"> 30 </span>37<span class="number"> 36 </span>37<span class="number"> 42 </span>39<span class="number"> 34 </span>31  D75125B70767B941</span><br><span class="line">+0x00000000021F73A0 <span class="number"> 34 </span>35<span class="number"> 42 </span>34<span class="number"> 37 </span>43<span class="number"> 31 </span>43<span class="number"> 42 </span>33<span class="number"> 43 </span>30<span class="number"> 37 </span>35<span class="number"> 35 </span>45  45B47C1CB3C0755E</span><br><span class="line">+0x00000000021F73B0 <span class="number"> 37 </span>43<span class="number"> 43 </span>42<span class="number"> 38 </span>38<span class="number"> 32 </span>35<span class="number"> 43 </span>35<span class="number"> 44 </span>43<span class="number"> 45 </span>30<span class="number"> 43 </span>35  7CCB8825C5DCE0C5</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line">@ +0x021f708c</span><br><span class="line">Previous:</span><br><span class="line">+0x00000000021F7080 <span class="number"> 31 </span>32<span class="number"> 32 </span>35 4f<span class="number"> 45 </span>29 2e<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 39 </span>32<span class="number"> 39 </span>33  1225OE).....9293</span><br><span class="line">+0x00000000021F7090 <span class="number"> 33 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00  3...............</span><br><span class="line">After:</span><br><span class="line">+0x00000000021F7080 <span class="number"> 31 </span>32<span class="number"> 32 </span>35 4f<span class="number"> 45 </span>29 2e<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 32 </span>37<span class="number"> 45 </span>38  1225OE).....27E8</span><br><span class="line">+0x00000000021F7090 <span class="number"> 45 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00  E...............</span><br><span class="line"> </span><br><span class="line">MESSAGE: Patch has been done successfully.</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>接下来使用<code>navicat-keygen.exe</code>来生成序列号和激活码</li>
</ol>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navicat-keygen.exe &lt;-bin|-<span class="built_in">text</span>&gt; [-adv] &lt;RSA<span class="number">-2048</span> PrivateKey(PEM <span class="built_in">file</span>)&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;-bin|-text&gt;</code>: 必须是<code>-bin</code>或<code>-text</code>。</li>
</ul>
<p>如果指定了<code>-bin</code>，<code>navicat-keygen.exe</code>最终将生成<code>license_file</code>文件。这个选项是给Navicat旧激活方式使用的。</p>
<p>如果指定了<code>-text</code>，<code>navicat-keygen.exe</code>最终将生成Base64样式的激活码。这个选项是给Navicat新激活方式使用的。</p>
<p><strong>这个参数必须指定。</strong></p>
<ul>
<li><code>[-adv]</code>: 开启高级模式。</li>
</ul>
<p><strong>这个参数是可选的。</strong> 如果指定了这个参数，<code>navicat-keygen.exe</code>将会要求你手工填写产品ID号、语言标识号。这个选项一般是给以后用的。</p>
<ul>
<li><code>&lt;RSA-2048 PrivateKey(PEM file)&gt;</code>: RSA-2048私钥文件的完整路径或相对路径。</li>
</ul>
<p><strong>这个参数必须指定。</strong></p>
<p><strong>例如：(在cmd.exe中)</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">navicat-keygen</span><span class="selector-class">.exe</span> <span class="selector-tag">-text</span> .\<span class="selector-tag">RegPrivateKey</span><span class="selector-class">.pem</span></span><br></pre></td></tr></table></figure>

<p>你会被要求选择Navicat产品类别、语言以及输入主版本号。之后会随机生成一个序列号。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Select Navicat product:</span><br><span class="line"><span class="bullet">0. </span>DataModeler</span><br><span class="line"><span class="bullet">1. </span>Premium</span><br><span class="line"><span class="bullet">2. </span>MySQL</span><br><span class="line"><span class="bullet">3. </span>PostgreSQL</span><br><span class="line"><span class="bullet">4. </span>Oracle</span><br><span class="line"><span class="bullet">5. </span>SQLServer</span><br><span class="line"><span class="bullet">6. </span>SQLite</span><br><span class="line"><span class="bullet">7. </span>MariaDB</span><br><span class="line"><span class="bullet">8. </span>MongoDB</span><br><span class="line"><span class="bullet">9. </span>ReportViewer</span><br><span class="line"> </span><br><span class="line">(Input index)&gt; 1</span><br><span class="line"> </span><br><span class="line">Select product language:</span><br><span class="line"><span class="bullet">0. </span>English</span><br><span class="line"><span class="bullet">1. </span>Simplified Chinese</span><br><span class="line"><span class="bullet">2. </span>Traditional Chinese</span><br><span class="line"><span class="bullet">3. </span>Japanese</span><br><span class="line"><span class="bullet">4. </span>Polish</span><br><span class="line"><span class="bullet">5. </span>Spanish</span><br><span class="line"><span class="bullet">6. </span>French</span><br><span class="line"><span class="bullet">7. </span>German</span><br><span class="line"><span class="bullet">8. </span>Korean</span><br><span class="line"><span class="bullet">9. </span>Russian</span><br><span class="line"><span class="bullet">10. </span>Portuguese</span><br><span class="line"> </span><br><span class="line">(Input index)&gt; 1</span><br><span class="line"> </span><br><span class="line">(Input major version number, range: 0 ~ 15, default: 12)&gt; 12</span><br><span class="line"> </span><br><span class="line">Serial number:</span><br><span class="line">NAVO-2ORP-IN5A-GQEE</span><br><span class="line"> </span><br><span class="line">Your name:</span><br></pre></td></tr></table></figure>

<p>你可以使用这个序列号暂时激活Navicat。</p>
<p>接下来你会被要求输入<code>用户名</code>和<code>组织名</code>；请随便填写，但不要太长。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Your name: root</span><br><span class="line">Your organization: root</span><br><span class="line">Input request code (<span class="keyword">in</span> Base64), input <span class="literal">empty</span> <span class="built_in">line</span> <span class="built_in">to</span> <span class="keyword">end</span>:</span><br></pre></td></tr></table></figure>

<p>之后你会被要求填入请求码，该请求码是在navicat中输入上方生成序列号进行离线激活后，会生成一段请求码，然后复制过来。注意 <strong>不要关闭命令行</strong>.</p>
<p><strong>断开网络</strong> 并打开Navicat。找到<code>注册</code>窗口，并填入keygen给你的序列号。然后点击<code>激活</code>按钮。</p>
<p><img src="1.png" alt></p>
<p>一般来说在线激活肯定会失败，这时候Navicat会询问你是否<code>手动激活</code>，直接选吧。</p>
<p>在<code>手动激活</code>窗口你会得到一个请求码，复制它并把它粘贴到keygen里。最后别忘了连按至少 <strong>两下回车</strong> 结束输入。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Your <span class="string">name:</span> root</span><br><span class="line">Your <span class="string">organization:</span> root</span><br><span class="line"></span><br><span class="line">Input request code (<span class="keyword">in</span> Base64), input empty line to <span class="string">end:</span></span><br><span class="line">EnoJQKOD5h08rGvcpxJ288YwA0e5AjIlu<span class="regexp">/WQUVde9rcnjC4RfYPQ83Rp047nohWBn02UELpAt9NAVWp6Nww+4gxQjgkXJ19wb6cRY+V68xLIJbZXmByXBQwWL4X4lB3RxpcS5y2fAk/</span>iipFaFu5XE8yhC1o129IVuuaCE3lwzAuB563BKSKmp4Xr1vSqW6EDeCtKp8PY91nSt4htHF11Sfx8v0ASfdbu75ePTB3Rf<span class="regexp">/nzkbCKv8E63E6mVSRWqDuQ8didqXQhci7qjPICvBD6ne5FZhDGEJi6hNSwdKeTbj/</span>ZUBxFScZYWsskFjVL5u5RcdLo0Gzp8H7YOTI7OfJarg==</span><br><span class="line"></span><br><span class="line">Request <span class="string">Info:</span></span><br><span class="line">&#123;<span class="string">"K"</span>:<span class="string">"NAVADD22GI4NXPU5"</span>, <span class="string">"DI"</span>:<span class="string">"DJym852txVo8XGZkDzPn"</span>, <span class="string">"P"</span>:<span class="string">"WIN"</span>&#125;</span><br><span class="line"></span><br><span class="line">Response <span class="string">Info:</span></span><br><span class="line">&#123;<span class="string">"K"</span>:<span class="string">"NAVADD22GI4NXPU5"</span>,<span class="string">"DI"</span>:<span class="string">"DJym852txVo8XGZkDzPn"</span>,<span class="string">"N"</span>:<span class="string">"root"</span>,<span class="string">"O"</span>:<span class="string">"root"</span>,<span class="string">"T"</span>:<span class="number">1565768523</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">License:</span></span><br><span class="line">GUk9coMkfoI2AtUiQ2PfDjlR6rybOrhY+q6azg5f7H+AwgIsVp6jWS1vb2NgkiXx</span><br><span class="line">u9NuoNeR8T2JiOqRC90umfdEqit0MGaGpDL/Wk6o+HNcKZmdbl9tImhGxxaj3Qib</span><br><span class="line">Yn3EzIQOz+hP7ipoG7kmIxzvmBOok0tDhrOhDzhzsPmAvFxTndQgU5hgCOIcHJVT</span><br><span class="line">PerF<span class="regexp">/SK/</span>lTMHSWqgwNyl2M3APBCxvCIjw6omFNwRXY3JD3zKUIiSWqsQT0mCBDby</span><br><span class="line"><span class="number">4</span>k1V7IhCBzOHpBTHLLbjSG8copp37rgcn8PK0FFL8yUCDCmYzDBvE8B1KTYgmNn6</span><br><span class="line">dWf7BT0jyOoRIoYwIApNmQ==</span><br></pre></td></tr></table></figure>

<p><img src="2.png" alt></p>
<p>如果不出意外，你会得到一个看似用Base64编码的激活码 <em>license</em>。直接复制它，并把它粘贴到Navicat的<code>手动激活</code>窗口，最后点<code>激活</code>按钮。如果没什么意外的话应该能成功激活。</p>
<p>转载至 <a href="https://blog.csdn.net/weixin_43160151/article/details/82913382" target="_blank" rel="noopener">Navicat脱机激活(亲测Navicat for MySQL)</a></p>

      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/08/09/2019-8-9-mysql主从复制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/09/2019-8-9-mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" class="post-title-link" itemprop="url">mysql实现主从复制</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年08月09日 11:30:09" itemprop="dateCreated datePublished" datetime="2019-08-09T11:30:09+08:00">2019年08月09日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/08/09/2019-8-9-mysql主从复制/" class="post-meta-item leancloud_visitors" data-flag-title="mysql实现主从复制" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/08/09/2019-8-9-mysql主从复制/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/08/09/2019-8-9-mysql主从复制/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-环境说明"><a href="#1-环境说明" class="headerlink" title="1. 环境说明"></a>1. 环境说明</h4><table>
<thead>
<tr>
<th>角色</th>
<th align="center">系统</th>
<th align="center">mysql 版本</th>
<th align="center">ip</th>
</tr>
</thead>
<tbody><tr>
<td>主</td>
<td align="center">centos7</td>
<td align="center">5.6</td>
<td align="center">192.168.139.132</td>
</tr>
<tr>
<td>从</td>
<td align="center">ubuntu 18.04.2</td>
<td align="center">5.7</td>
<td align="center">192.168.139.131</td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/08/09/2019-8-9-mysql主从复制/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/08/08/2019-8-8-linux上的mysql使用问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/08/2019-8-8-linux%E4%B8%8A%E7%9A%84mysql%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">linxu上的mysql只能sudo登陆</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年08月08日 14:30:00" itemprop="dateCreated datePublished" datetime="2019-08-08T14:30:00+08:00">2019年08月08日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/08/08/2019-8-8-linux上的mysql使用问题/" class="post-meta-item leancloud_visitors" data-flag-title="linxu上的mysql只能sudo登陆" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/08/08/2019-8-8-linux上的mysql使用问题/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/08/08/2019-8-8-linux上的mysql使用问题/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Ubuntu上的数据库修改密码"><a href="#Ubuntu上的数据库修改密码" class="headerlink" title="Ubuntu上的数据库修改密码"></a>Ubuntu上的数据库修改密码</h3><p>Ubuntu上的数据库安装好之后没有提示输入密码，自然后来 <code>mysql -uroot -p</code>不知道是什么密码，均是报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1045 (28000): Access denied <span class="keyword">for</span> user <span class="string">'root'</span>@<span class="string">'localhost'</span> (using password: YES)</span><br></pre></td></tr></table></figure>

<p>需要打开一个文件 <code>/etc/mysql/debian.cnf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/mysql/debian.cnf</span><br></pre></td></tr></table></figure>

<p><img src="mysql4.png" alt></p>
<p>将终端里登陆用的用户名root换成文件里的 <strong><em>debian-sys-maint</em></strong> 和 <strong><em>password</em></strong>值 进行数据库的登陆操作，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u debian-sys-maint -p</span><br></pre></td></tr></table></figure>

<p>这时再输入对应的密码就可以顺利登陆了，然后就要修改root的密码，不然用这个密码可太麻烦了。</p>
<p>系统所使用的是5.7版本的mysql，password字段已经被删除，取而代之的是authentication_string字段，所以要更改密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update mysql.user set authentication_string=password(&apos;password&apos;) where user=&apos;root&apos;and Host = &apos;localhost&apos;;</span><br></pre></td></tr></table></figure>

<p>若是出现下图则代表修改成功，之后只需要重启mysql就可以登陆了。</p>
<p><img src="mysql5.png" alt></p>
<hr>
<h3 id="Ubuntu-上的mysql只能sudo登陆"><a href="#Ubuntu-上的mysql只能sudo登陆" class="headerlink" title="Ubuntu 上的mysql只能sudo登陆"></a>Ubuntu 上的mysql只能sudo登陆</h3><p><img src="mysql1.png" alt="linxu上的mysql只能sudo登陆"></p>
<p>Ubuntu上安装好的mysql 5.7，无法用 <code>mysql -uroot -p</code> 进行登陆，只能通过<code>sudo mysql -uroot -p</code></p>
<h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><p><strong>修改MySQL配置文件，添加一句skip-grant-tables，重启即可无需密码登录</strong></p>
<h4 id="旧版mysql"><a href="#旧版mysql" class="headerlink" title="旧版mysql"></a>旧版mysql</h4><p>在Ubuntu，默认安装配置文件全路径 /etc/mysql/my.cnf</p>
<h4 id="新版MySQL"><a href="#新版MySQL" class="headerlink" title="新版MySQL"></a>新版MySQL</h4><p>对于5.7.23等高版本，配置文件路径和命令已经改变</p>
<p>此时的 <code>/etc/mysql/my.cnf</code> 文件已经是一个软链接，里面只有指向链接的语句。</p>
<p><img src="mysql2.png" alt="新版MySQL"></p>
<p>真正的配置文件是 <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br></pre></td></tr></table></figure>

<p><img src="mysql3.png" alt></p>
<p>在图中的位置添加 <code>skip-grant-tables</code>，之后重启mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysql</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="解决mysql无法远程连接的问题"><a href="#解决mysql无法远程连接的问题" class="headerlink" title="解决mysql无法远程连接的问题"></a>解决mysql无法远程连接的问题</h3><h4 id="创建远程登陆用户"><a href="#创建远程登陆用户" class="headerlink" title="创建远程登陆用户"></a>创建远程登陆用户</h4><p>Ubuntu上的mysql在默认情况下不支持用户通过非本机连接上数据库服务器，因此先要在mysql.user中创建可以远程连接的用户。</p>
<ol>
<li>先登陆数据库</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>选择数据库</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建远程登陆用户</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>

<ul>
<li>root ：用户名</li>
<li>%：任何ip都可登陆</li>
<li>123456：密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>重启mysql</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysql</span><br><span class="line">service mysqld restart // 皆可</span><br></pre></td></tr></table></figure>

<h4 id="修改mysql配置文件"><a href="#修改mysql配置文件" class="headerlink" title="修改mysql配置文件"></a>修改mysql配置文件</h4><p>修改 <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code></p>
<p>将里面的</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind-address = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> #注释掉</span><br></pre></td></tr></table></figure>

<p>然后重启mysql，</p>
<p>就可以远程访问mysql了。</p>
<hr>
<h3 id="如何删除mysql"><a href="#如何删除mysql" class="headerlink" title="如何删除mysql"></a>如何删除mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get autoremove --purge mysql-server-5.7</span><br><span class="line">sudo apt-get remove mysql-server</span><br><span class="line">sudo apt-get autoremove mysql-server</span><br><span class="line">sudo apt-get remove mysql-common</span><br></pre></td></tr></table></figure>

<p><strong>之后需要清理残余数据</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l |grep ^rc|awk <span class="string">'&#123;print $2&#125;'</span> |sudo xargs dpkg -P</span><br></pre></td></tr></table></figure>

<p>摘录自:point_right::point_right::point_right:<a href="https://blog.csdn.net/sinat_21302587/article/details/76870457" target="_blank" rel="noopener">ubuntu安装mysql 时未提示输入密码</a></p>

      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/08/08/2019-08-08-Spring-Scheduler的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/08/2019-08-08-Spring-Scheduler%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Spring Scheduler的使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年08月08日 11:30:00" itemprop="dateCreated datePublished" datetime="2019-08-08T11:30:00+08:00">2019年08月08日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/08/08/2019-08-08-Spring-Scheduler的使用/" class="post-meta-item leancloud_visitors" data-flag-title="Spring Scheduler的使用" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/08/08/2019-08-08-Spring-Scheduler的使用/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/08/08/2019-08-08-Spring-Scheduler的使用/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><blockquote>
<p>Spring Scheduler里有两个概念：任务（Task）和运行任务的框架（TaskExecutor/TaskScheduler）。TaskExecutor顾名思义，是任务的执行器，允许我们异步执行多个任务。TaskScheduler是任务调度器，来运行未来的定时任务。触发器Trigger可以决定定时任务是否该运行了，最常用的触发器是CronTrigger，具体用法会在下面章节中详细介绍。Spring内置了多种类型的TaskExecutor和TaskScheduler，方便用户根据不同业务场景选择。</p>
</blockquote>
<p>参考<a href="https://www.baeldung.com/spring-scheduled-tasks" target="_blank" rel="noopener">这篇短文</a>可以快速入门</p>
<hr>
<h4 id="Cron"><a href="#Cron" class="headerlink" title="Cron"></a>Cron</h4><p>Cron表达式由6~7项组成，中间用空格分开。从左到右依次是：<strong>秒、分、时、日、月、周几、年（可省略）</strong>。值可以是数字，也可以是以下符号：</p>
<ul>
<li><p><code>*</code>：所有值都匹配</p>
</li>
<li><p><code>?</code>：无所谓，不关心，通常放在“周几”里</p>
</li>
<li><p><code>,</code>：或者</p>
</li>
<li><p><code>/</code>：增量值</p>
</li>
<li><p><code>-</code>：区间</p>
</li>
</ul>
<p>下面举几个例子，看了就知道了：<br><code>0 * * * * *</code>：每分钟（当秒为0的时候）<br><code>0 0 * * * *</code>：每小时（当秒和分都为0的时候）<br><code>*/10 * * * * *</code>：每10秒<br><code>0 5/15 * * * *</code>：每小时的5分、20分、35分、50分<br><code>0 0 9,13 * * *</code>：每天的9点和13点<br><code>0 0 8-10 * * *</code>：每天的8点、9点、10点<br><code>0 0/30 8-10 * * *</code>：每天的8点、8点半、9点、9点半、10点<br><code>0 0 9-17 * * MON-FRI</code>：每周一到周五的9点、10点…直到17点（含）<br><code>0 0 0 25 12 ?</code>：每年12约25日圣诞节的0点0分0秒（午夜）<br><code>0 30 10 * * ? 2016</code>：2016年每天的10点半</p>
<p>其中的<code>?</code>在用法上其实和<code>*</code>是相同的。但是<code>*</code>语义上表示全匹配，而<code>?</code>并不代表全匹配，而是不关心。比如对于<code>0 0 0 5 8 ? 2016</code>来说，2016年8月5日是周五，<code>?</code>表示我不关心它是周几。而<code>0 0 0 5 8 * 2016</code>中的<code>*</code>表示周一也行，周二也行……语义上和2016年8月5日冲突了，你说谁优先生效呢。</p>
<p>不记得也没关系，记住<a href="http://www.cronmaker.com/" target="_blank" rel="noopener">Cron Maker</a>也可以，它可以在线生成cron表达式。</p>
<hr>
<p>如果想在不同的开发环境中使用不同的定时器，可以在<code>application.properties</code> 中进行配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// application properties</span><br><span class="line">// java的properties文件支持value中带空格</span><br><span class="line">cron_expression = 0 0/2 * * * ?</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled</span>(cron = <span class="string">"$&#123;cron_expression&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">catchAllPicture</span><span class="params">()</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>:point_right::point_right::point_right:摘录自<a href="https://qinghua.github.io/spring-scheduler/" target="_blank" rel="noopener"><a href="https://qinghua.github.io/spring-scheduler/" target="_blank" rel="noopener">Spring Scheduler的使用与坑</a></a></p>

      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhizhi.tangliangdong.me/2019/08/08/2019-8-8-websocket-spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="XiaoTang">
      <meta itemprop="description" content="你的指尖拥有改变世界的力量">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiaoTang' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/08/2019-8-8-websocket-spring/" class="post-title-link" itemprop="url">java客户端连接websocket</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019年08月08日 10:30:20" itemprop="dateCreated datePublished" datetime="2019-08-08T10:30:20+08:00">2019年08月08日</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019年11月18日 11:38:34" itemprop="dateModified" datetime="2019-11-18T11:38:34+08:00">2019年11月18日</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn/" itemprop="url" rel="index">
                    <span itemprop="name">learn</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/08/08/2019-8-8-websocket-spring/" class="post-meta-item leancloud_visitors" data-flag-title="java客户端连接websocket" title="热度">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">热度</span>
              <span class="leancloud-visitors-count"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/08/08/2019-8-8-websocket-spring/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/08/08/2019-8-8-websocket-spring/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="spring-websocket-访问"><a href="#spring-websocket-访问" class="headerlink" title="spring websocket 访问"></a>spring websocket 访问</h3><h4 id="websocket类"><a href="#websocket类" class="headerlink" title="websocket类"></a>websocket类</h4>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/08/08/2019-8-8-websocket-spring/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      

      <div>
        
      </div>
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="XiaoTang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">XiaoTang</p>
  <div class="site-description" itemprop="description">你的指尖拥有改变世界的力量</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">124</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">98</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tangliangdong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tangliangdong" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xiaotang188@gmail.com" title="E-Mail → mailto:xiaotang188@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer" id="footer" >
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XiaoTang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">347k</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="site-uv">
      我的第 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 位朋友，
    </span>
    <span class="site-pv">
      历经 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次回眸才与你相遇
    </span>
</div>






  <script>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.getAttribute('data-flag-title');

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=es3tC97u1gwqYCpsdPqXvpVA-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'es3tC97u1gwqYCpsdPqXvpVA-gzGzoHsz',
            'X-LC-Key': 'AJ3paOnlxYMTA5dQejavW0MO',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>

  <script defer src="[object Object]"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  




  <script src="/js/local-search.js"></script>












  

  


  

  <script async src="/js/cursor/fireworks.js"></script>





  <script src="/js/wobblewindow.js"></script>
  <script>
    //只在桌面版网页启用特效
    if( window.innerWidth > 768  ){
      $(document).ready(function () {
        
          $('#header').wobbleWindow({
            radius: 50,
            movementTop: false,
            movementLeft: false,
            movementRight: false,
            debug: false,
          });
        

        
          $('#sidebar').wobbleWindow({
            radius: 50,
            movementLeft: false,
            movementTop: false,
            movementBottom: false,
            position: 'fixed',
            debug: false,
          });
        

        
          $('#footer').wobbleWindow({
            radius: 50,
            movementBottom: false,
            movementLeft: false,
            movementRight: false,
            offsetX: 0,
            position: 'absolute',
            debug: false,
          });
        
      });
    }
  </script>



 
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-precise-range-plugin@1.3.0/moment-precise-range.min.js"></script>
<script>
  function timer() {
    var ages = moment.preciseDiff(moment(),moment(20161001,"YYYYMMDD"));
    ages = ages.replace(/years?/, "年");
    ages = ages.replace(/months?/, "月");
    ages = ages.replace(/days?/, "天");
    ages = ages.replace(/hours?/, "小时");
    ages = ages.replace(/minutes?/, "分");
    ages = ages.replace(/seconds?/, "秒");
    ages = ages.replace(/\d+/g, '<span style="color:#1890ff">$&</span>');
    div.innerHTML = `我已在此等候你 ${ages}`;
  }
  var div = document.createElement("div");
  //插入到copyright之后
  var copyright = document.querySelector(".copyright");
  console.log(copyright)
  document.querySelector(".footer-inner").insertBefore(div, copyright.nextSibling);
  timer();
  setInterval("timer()",1000)
</script>




<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

 
<script>
  var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(つェ⊂)我藏好了哦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });
</script>



<script type="text/javascript" src="/js/clipboard.min.js"></script>  
<script type="text/javascript" src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r79/three.min.js"></script>

<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('[object Object]', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el: '#valine-comments',
      verify: false,
      notify: true,
      appId: 'es3tC97u1gwqYCpsdPqXvpVA-gzGzoHsz',
      appKey: 'AJ3paOnlxYMTA5dQejavW0MO',
      placeholder: "Just go go",
      avatar: 'mm',
      meta: guest,
      pageSize: '10' || 10,
      visitor: false,
      lang: '' || 'zh-cn',
      path: location.pathname,
      recordIP: false,
      serverURLs: ''
    });
  }, window.Valine);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":300,"height":600},"mobile":{"show":false,"react":{"opacity":0.7}}});</script></body>
</html>
